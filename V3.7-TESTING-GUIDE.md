# V3.7 沉浸式通知系統測試指南

## 🎯 測試目標

驗證兩種通知功能：
1. **手動通知**：主持人點擊「提醒聽牌」→ 玩家看到置中彈窗
2. **自動里程碑通知**：開球達到特定數量（45/55/65/70）→ 自動彈窗

---

## 📋 測試前準備

### 必要裝置
- **裝置 A**：電腦/手機（玩家頁面）
- **裝置 B**：電腦/手機（管理者頁面）

### 測試環境
- **本地測試**：http://localhost:3001/bingo/
- **生產環境**：https://market.hiyoshop.store/bingo/

---

## 🧪 測試案例 1：手動通知

### 測試步驟

1. **裝置 A**：開啟玩家頁面
   ```
   http://localhost:3001/bingo/
   ```
   - 如果彈出暱稱輸入框，輸入「測試玩家A」
   - 確認頁面顯示「LIVE CONNECTION」
   - **保持此頁面開啟**

2. **裝置 B**：開啟管理者頁面
   ```
   http://localhost:3001/bingo/admin
   ```
   - 確認頁面顯示「SYSTEM ONLINE」
   - 找到「🔔 提醒聽牌」按鈕

3. **裝置 B**：點擊「🔔 提醒聽牌」按鈕

4. **裝置 A**：立即查看玩家頁面

### 預期結果

**裝置 A 應該彈出沉浸式通知 Modal：**

```
┌─────────────────────────────────────┐
│                                     │
│        主持人提醒 🔔                │
│                                     │
│  請檢查您的賓果卡，看看是否已經      │
│        聽牌了！                     │
│                                     │
│  ┌───────────────────────────────┐  │
│  │  目前已開出 0 球              │  │
│  └───────────────────────────────┘  │
│                                     │
│  ┌───────────────────────────────┐  │
│  │          好的                 │  │
│  └───────────────────────────────┘  │
│                                     │
└─────────────────────────────────────┘
```

**設計特徵：**
- ✅ 黃色背景 (`bg-yellow-300`)
- ✅ 粗黑邊框 (`border-4 border-black`)
- ✅ Neobrutalism 陰影 (`shadow-[12px_12px_0px_0px_rgba(0,0,0,1)]`)
- ✅ 半透明黑色遮罩 (`rgba(0, 0, 0, 0.6)`)
- ✅ 顯示當前已開球數
- ✅ 10 秒後自動關閉

### 伺服器日誌驗證

```bash
pm2 logs bingo-game --lines 10
```

應該看到：
```
[Socket.IO] Remind check triggered by admin
```

### 瀏覽器 Console 驗證

**裝置 A** 按 F12 → Console 標籤，應該看到：
```
[Socket.IO] Immersive notification received: {type: "manual_reminder", title: "主持人提醒 🔔", ...}
```

---

## 🧪 測試案例 2：自動里程碑通知（45 球）

### 測試步驟

1. **裝置 A**：開啟玩家頁面並保持連線
   ```
   http://localhost:3001/bingo/
   ```

2. **裝置 B**：開啟管理者頁面
   ```
   http://localhost:3001/bingo/admin
   ```

3. **裝置 B**：依序點擊號碼 1-45
   - 點擊號碼 1
   - 點擊號碼 2
   - ...
   - 點擊號碼 45

4. **裝置 A**：在點擊第 45 個號碼時，立即查看玩家頁面

### 預期結果

**當開出第 45 顆球時，裝置 A 應該彈出：**

```
┌─────────────────────────────────────┐
│                                     │
│          遊戲過半                   │
│                                     │
│    已開出 45 球，請把握機會！       │
│                                     │
│  ┌───────────────────────────────┐  │
│  │  目前已開出 45 球             │  │
│  └───────────────────────────────┘  │
│                                     │
│  ┌───────────────────────────────┐  │
│  │          好的                 │  │
│  └───────────────────────────────┘  │
│                                     │
└─────────────────────────────────────┘
```

### 伺服器日誌驗證

```bash
pm2 logs bingo-game --lines 20
```

應該看到：
```
[Socket.IO] Number 45 clicked
[Socket.IO] Milestone reached: 45 balls
```

---

## 🧪 測試案例 3：所有里程碑通知

### 測試目標

驗證所有 4 個里程碑通知是否正確觸發。

### 測試步驟

1. **裝置 A**：開啟玩家頁面並保持連線
2. **裝置 B**：開啟管理者頁面
3. **裝置 B**：依序點擊號碼，觀察裝置 A 的通知

### 里程碑檢查清單

| 球數 | 標題 | 訊息 | 狀態 |
|------|------|------|------|
| 45 球 | 遊戲過半 | 已開出 45 球，請把握機會！ | ⬜ |
| 55 球 | 緊張時刻 | 剩下最後 20 顆球！ | ⬜ |
| 65 球 | 最後階段 | 剩下最後 10 顆球，快檢查你的牌！ | ⬜ |
| 70 球 | 決勝時刻！ | 剩下最後 5 顆球！成敗在此一舉！ | ⬜ |

### 注意事項

- ✅ 每個里程碑只觸發一次（不會重複）
- ✅ 通知會自動在 10 秒後關閉
- ✅ 可以手動點擊「好的」按鈕關閉
- ✅ 通知顯示時，背景遊戲仍可見（半透明遮罩）

---

## 🧪 測試案例 4：通知關閉機制

### 測試目標

驗證通知的關閉機制是否正常。

### 測試步驟

1. 觸發任意通知（手動或自動）
2. 測試以下關閉方式：

#### 方式 1：點擊「好的」按鈕
- 點擊通知中的「好的」按鈕
- **預期**：通知立即關閉，動畫流暢

#### 方式 2：點擊背景遮罩
- 點擊通知外的半透明黑色區域
- **預期**：通知立即關閉

#### 方式 3：自動關閉
- 不做任何操作，等待 10 秒
- **預期**：通知自動關閉

---

## 🧪 測試案例 5：多玩家場景

### 測試目標

驗證通知是否正確廣播給所有玩家。

### 測試步驟

1. **裝置 A**：開啟玩家頁面（玩家 A）
2. **裝置 B**：開啟玩家頁面（玩家 B）
3. **裝置 C**：開啟管理者頁面
4. **裝置 C**：點擊「提醒聽牌」

### 預期結果

- ✅ 裝置 A 彈出通知
- ✅ 裝置 B 彈出通知
- ✅ 兩個通知內容完全相同
- ✅ 顯示相同的已開球數

---

## 🧪 測試案例 6：通知堆疊測試

### 測試目標

驗證快速觸發多個通知時的行為。

### 測試步驟

1. **裝置 A**：開啟玩家頁面
2. **裝置 B**：開啟管理者頁面
3. **裝置 B**：快速點擊「提醒聽牌」3 次

### 預期結果

- ✅ 第一個通知顯示
- ✅ 第二個通知覆蓋第一個（不堆疊）
- ✅ 第三個通知覆蓋第二個
- ✅ 最終只顯示最後一個通知

---

## 🐛 已知問題與限制

### 問題 1：頁面重新載入錯過通知
**現象**：如果玩家頁面在通知發送後才載入，會錯過通知。
**原因**：Socket.IO 事件不會持久化。
**解決方案**：這是正常行為，通知是即時的，不需要持久化。

### 問題 2：單一瀏覽器視窗測試限制
**現象**：在同一個瀏覽器視窗切換頁面會導致 Socket 斷線。
**解決方案**：使用多個裝置或瀏覽器無痕模式測試。

---

## 📊 測試結果記錄表

### 手動通知測試

| 測試項目 | 預期結果 | 實際結果 | 狀態 |
|----------|----------|----------|------|
| 通知彈出 | 顯示黃色 Modal | | ⬜ |
| 標題正確 | 「主持人提醒 🔔」 | | ⬜ |
| 訊息正確 | 「請檢查您的賓果卡...」 | | ⬜ |
| 球數正確 | 顯示當前已開球數 | | ⬜ |
| 手動關閉 | 點擊「好的」關閉 | | ⬜ |
| 背景關閉 | 點擊遮罩關閉 | | ⬜ |
| 自動關閉 | 10 秒後自動關閉 | | ⬜ |

### 自動里程碑通知測試

| 里程碑 | 觸發時機 | 標題 | 訊息 | 狀態 |
|--------|----------|------|------|------|
| 45 球 | 開出第 45 顆球 | 遊戲過半 | 已開出 45 球... | ⬜ |
| 55 球 | 開出第 55 顆球 | 緊張時刻 | 剩下最後 20 顆球！ | ⬜ |
| 65 球 | 開出第 65 顆球 | 最後階段 | 剩下最後 10 顆球... | ⬜ |
| 70 球 | 開出第 70 顆球 | 決勝時刻！ | 剩下最後 5 顆球！... | ⬜ |

### 多玩家測試

| 測試項目 | 預期結果 | 實際結果 | 狀態 |
|----------|----------|----------|------|
| 廣播給所有玩家 | 所有玩家收到通知 | | ⬜ |
| 內容一致性 | 所有玩家看到相同內容 | | ⬜ |
| 球數同步 | 所有玩家看到相同球數 | | ⬜ |

---

## 🔍 除錯指令

### 檢查伺服器日誌
```bash
pm2 logs bingo-game --lines 50
```

### 檢查 Socket.IO 連線
```bash
pm2 logs bingo-game | grep "Socket.IO"
```

### 檢查里程碑觸發
```bash
pm2 logs bingo-game | grep "Milestone"
```

### 檢查通知發送
```bash
pm2 logs bingo-game | grep "show-immersive-notification"
```

---

## 📸 截圖清單

### 必須截圖
- [ ] 手動通知 Modal（完整畫面）
- [ ] 45 球里程碑通知
- [ ] 55 球里程碑通知
- [ ] 65 球里程碑通知
- [ ] 70 球里程碑通知
- [ ] 瀏覽器 Console 日誌
- [ ] 伺服器日誌

### 選擇性截圖
- [ ] 多玩家同時收到通知
- [ ] 通知關閉動畫
- [ ] 通知堆疊行為

---

## 🎥 錄製建議

### GIF 1：手動通知完整流程（20 秒）
1. 玩家頁面載入
2. 管理者點擊「提醒聽牌」
3. 玩家頁面彈出通知
4. 點擊「好的」關閉

### GIF 2：自動里程碑通知（30 秒）
1. 管理者快速點擊號碼 1-45
2. 第 45 顆球時彈出通知
3. 關閉通知
4. 繼續點擊到 55 球
5. 第 55 顆球時彈出通知

---

## ✅ 測試完成檢查清單

### 功能測試
- [ ] 手動通知正常彈出
- [ ] 45 球里程碑通知觸發
- [ ] 55 球里程碑通知觸發
- [ ] 65 球里程碑通知觸發
- [ ] 70 球里程碑通知觸發
- [ ] 通知內容正確顯示
- [ ] 已開球數正確顯示
- [ ] 手動關閉正常
- [ ] 背景點擊關閉正常
- [ ] 10 秒自動關閉正常

### 多玩家測試
- [ ] 通知廣播給所有玩家
- [ ] 多玩家內容一致
- [ ] 球數同步正確

### 設計驗證
- [ ] Neobrutalism 風格一致
- [ ] 黃色背景正確
- [ ] 粗黑邊框正確
- [ ] 陰影效果正確
- [ ] 半透明遮罩正確
- [ ] 動畫流暢

### 日誌驗證
- [ ] 伺服器日誌正確
- [ ] Console 日誌正確
- [ ] 無錯誤訊息

---

## 🚀 生產環境測試

### 部署前檢查
```bash
cd /root/bingo-game
git pull origin main
pnpm install
pnpm build
pm2 restart bingo-game
```

### 測試 URL
- 玩家頁面：https://market.hiyoshop.store/bingo/
- 管理者頁面：https://market.hiyoshop.store/bingo/admin

### 監控指令
```bash
pm2 logs bingo-game
pm2 monit
```

---

## 📝 測試報告範本

```markdown
## V3.7 測試報告

**測試日期**：2026-01-XX
**測試環境**：[本地/生產]
**測試人員**：[姓名]

### 測試結果
- ✅ 手動通知：通過
- ✅ 45 球里程碑：通過
- ✅ 55 球里程碑：通過
- ✅ 65 球里程碑：通過
- ✅ 70 球里程碑：通過
- ✅ 多玩家廣播：通過
- ✅ 關閉機制：通過

### 發現問題
1. [問題描述]
2. [重現步驟]
3. [預期行為]
4. [實際行為]

### 截圖附件
- v3.7-manual-notification.png
- v3.7-milestone-45.png
- ...
```

---

## 🎉 測試完成

所有測試通過後，V3.7 即可正式上線！
