# V3.7 版本發布說明

## 🎉 版本資訊

- **版本號**：V3.7
- **發布日期**：2026-01-20
- **Commit Hash**：2d49f7a
- **開發時間**：約 2 小時

---

## 🚀 新功能

### 1. 沉浸式通知系統

引入全新的「沉浸式通知系統」，包含兩個核心功能：

#### 📢 手動通知
- **觸發方式**：主持人點擊「🔔 提醒聽牌」按鈕
- **功能描述**：向所有玩家廣播提醒訊息
- **顯示內容**：
  - 標題：「主持人提醒 🔔」
  - 訊息：「請檢查您的賓果卡，看看是否已經聽牌了！」
  - 當前已開球數

#### 🎯 自動里程碑通知
- **觸發方式**：開球達到特定數量時自動彈出
- **里程碑列表**：
  | 球數 | 標題 | 訊息 |
  |------|------|------|
  | 45 球 | 遊戲過半 | 已開出 45 球，請把握機會！ |
  | 55 球 | 緊張時刻 | 剩下最後 20 顆球！ |
  | 65 球 | 最後階段 | 剩下最後 10 顆球，快檢查你的牌！ |
  | 70 球 | 決勝時刻！ | 剩下最後 5 顆球！成敗在此一舉！ |

---

## 🎨 設計特色

### Neobrutalism 風格
- **黃色背景**：`bg-yellow-300`
- **粗黑邊框**：`border-4 border-black`
- **立體陰影**：`shadow-[12px_12px_0px_0px_rgba(0,0,0,1)]`
- **半透明遮罩**：`rgba(0, 0, 0, 0.6)`

### 互動體驗
- **彈出動畫**：流暢的縮放動畫（scale 0.9 → 1.0）
- **淡入效果**：透明度動畫（opacity 0 → 1）
- **多種關閉方式**：
  - 點擊「好的」按鈕
  - 點擊背景遮罩
  - 10 秒後自動關閉

---

## 📁 檔案變更

### 新增檔案
1. **client/src/components/ImmersiveNotificationModal.tsx**
   - 沉浸式通知 Modal 元件
   - 89 行程式碼
   - 完整的動畫和關閉邏輯

2. **V3.7-TESTING-GUIDE.md**
   - 完整的測試指南文件
   - 包含 6 個測試案例
   - 除錯指令和測試記錄表

### 修改檔案
1. **client/src/contexts/SocketContext.tsx**
   - 新增 `ImmersiveNotificationData` interface
   - 新增 `immersiveNotification` state
   - 新增 `show-immersive-notification` 事件監聽
   - 新增 `clearImmersiveNotification` 函數

2. **client/src/pages/Home.tsx**
   - Import `ImmersiveNotificationModal` 元件
   - 整合通知 Modal 到頁面
   - 傳遞 `immersiveNotification` 和 `clearImmersiveNotification`

3. **server/index.ts**
   - 升級 `remind-check` 事件處理
   - 新增自動里程碑通知邏輯
   - 在 `number-clicked` 事件中檢查里程碑

---

## 🔧 技術實作

### 前端架構

```
client/src/
├── components/
│   └── ImmersiveNotificationModal.tsx  ← 新增
├── contexts/
│   └── SocketContext.tsx               ← 修改
└── pages/
    └── Home.tsx                         ← 修改
```

### 後端架構

```
server/
└── index.ts                             ← 修改
    ├── remind-check 事件                ← 升級
    └── number-clicked 事件              ← 新增里程碑邏輯
```

### Socket.IO 事件

#### 新增事件
- **show-immersive-notification**
  - 方向：Server → Client
  - 數據結構：
    ```typescript
    {
      type: 'manual_reminder' | 'milestone',
      title: string,
      message: string,
      current_ball_count: number
    }
    ```

#### 保留事件
- **bingo-check-alert**（向下兼容）
  - 方向：Server → Client
  - 用途：舊版本的提醒聽牌功能

---

## 📊 程式碼統計

### 新增程式碼
- **ImmersiveNotificationModal.tsx**：89 行
- **SocketContext.tsx**：+20 行
- **Home.tsx**：+5 行
- **server/index.ts**：+40 行
- **總計**：約 154 行新增程式碼

### 測試文件
- **V3.7-TESTING-GUIDE.md**：約 600 行

---

## 🧪 測試狀態

### 本地測試
- ✅ 編譯成功
- ✅ 伺服器啟動正常
- ✅ Socket.IO 連線正常
- ✅ 事件發送確認（伺服器日誌）
- 🔄 多視窗測試待生產環境驗證

### 待測試項目
- [ ] 手動通知彈出測試
- [ ] 45 球里程碑通知
- [ ] 55 球里程碑通知
- [ ] 65 球里程碑通知
- [ ] 70 球里程碑通知
- [ ] 多玩家廣播測試
- [ ] 通知關閉機制測試

---

## 🚀 部署指南

### 快速部署（生產環境）

```bash
ssh root@45.77.170.104
cd /root/bingo-game
git pull origin main
pnpm install
pnpm build
pm2 restart bingo-game
pm2 logs bingo-game --lines 20
```

### 驗證步驟

1. **檢查伺服器啟動**
   ```bash
   pm2 status bingo-game
   ```

2. **檢查日誌**
   ```bash
   pm2 logs bingo-game --lines 50
   ```

3. **測試手動通知**
   - 開啟玩家頁面：https://market.hiyoshop.store/bingo/
   - 開啟管理者頁面：https://market.hiyoshop.store/bingo/admin
   - 點擊「🔔 提醒聽牌」
   - 確認玩家頁面彈出通知

4. **測試自動通知**
   - 管理者頁面點擊號碼 1-45
   - 確認第 45 顆球時彈出「遊戲過半」通知

---

## 📚 相關文件

- **測試指南**：V3.7-TESTING-GUIDE.md
- **版本說明**：V3.7-RELEASE-NOTES.md（本文件）
- **GitHub Commit**：https://github.com/hiyomarket/bingo-game/commit/2d49f7a

---

## 🔄 向下兼容性

### 保留功能
- ✅ 舊版 `bingo-check-alert` 事件仍然發送
- ✅ 舊版提醒文字仍然顯示（頂部黃色橫幅）
- ✅ 所有現有功能不受影響

### 新功能
- ✅ 新增沉浸式通知 Modal（不影響舊功能）
- ✅ 新增自動里程碑通知（純新增功能）

---

## 🐛 已知問題

### 問題 1：單視窗測試限制
**描述**：在同一個瀏覽器視窗切換頁面會導致 Socket 斷線，無法測試通知功能。
**影響範圍**：僅限本地開發測試。
**解決方案**：使用多個裝置或瀏覽器無痕模式測試。
**狀態**：這是正常行為，不是 bug。

### 問題 2：通知不持久化
**描述**：如果玩家頁面在通知發送後才載入，會錯過通知。
**影響範圍**：所有環境。
**解決方案**：這是設計行為，通知是即時的，不需要持久化。
**狀態**：這是正常行為，不是 bug。

---

## 🎯 未來改進建議

### 短期改進（V3.8）
1. **通知音效**：添加通知音效提升體驗
2. **通知歷史**：記錄最近的通知（可選功能）
3. **自訂里程碑**：允許主持人自訂里程碑球數

### 中期改進（V3.9+）
1. **通知樣式自訂**：允許更換顏色主題
2. **多語言支援**：支援英文、日文等語言
3. **通知統計**：記錄通知發送次數和查看率

### 長期改進（V4.0+）
1. **推送通知**：支援瀏覽器推送通知（PWA）
2. **通知排程**：預先設定通知時間
3. **A/B 測試**：測試不同通知文案的效果

---

## 📞 支援與回饋

### 問題回報
- **GitHub Issues**：https://github.com/hiyomarket/bingo-game/issues
- **Email**：[您的 Email]

### 測試回饋
請在測試完成後提供以下資訊：
1. 測試環境（本地/生產）
2. 測試裝置（電腦/手機/平板）
3. 測試結果（通過/失敗）
4. 截圖或 GIF
5. 發現的問題

---

## 🎉 致謝

感謝所有參與測試和回饋的使用者！

---

**V3.7 開發完成！準備部署到生產環境！** 🚀
